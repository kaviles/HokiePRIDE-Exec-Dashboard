<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="../../../bower_components/core-ajax/core-ajax.html">

<polymer-element name="custom-dialog-addBoardMember" layout vertical center-justified>

	<template>
		<style>    
			:host {
				background-color: white;
				padding: 5px;
				margin: 5px;

				/*border-style: solid;
				border-width: 1px;
				border-color: orange;*/
			}
			#header {
				margin: 0px 0px 0px 0px;
			}
		</style>

		<div id='header'>Add Exec Board Member</div>
		<section id='form0' layout vertical>
	    	<template repeat='{{input in inputs}}'>
	    		<paper-input-decorator id='{{input.id}}' label='{{input.label}}' floatinglabel error='{{input.label}} is required!' layout="" vertical="">
				<input is="core-input" required="" placeholder="required" aria-label="required">
	    	</paper-input-decorator>
	    	</template>
    	</section>
    	<core-tooltip id='tooltip' label='' position='bottom'>
	    	<paper-button raised role='button' on-tap='{{validateForm}}'>Add Board Member</paper-button>
		</core-tooltip>

	    <core-ajax id='ajaxAdd' url='../../phpcommands/addBoardMember.php' params='' handleAs='json' method='POST' on-core-response='{{ajaxResponse}}'></core-ajax>
	</template>

	<script>
    Polymer( 'custom-dialog-addBoardMember', {
    /**
     * Specifies the label of the individual tile.
     *
     * @attribute label
     * @type string
     * @default ''
     */

    ready: function() {
    	this.inputs = [{id:'firstname', label:'First Name'},
    	{id:'lastname', label:'Last Name'},
    	{id:'position', label:'Position'},
    	{id:'pid', label:'VT PID'}];
	},

	validateForm: function() {

		var fnField = this.$.form0.querySelector('#firstname');
		var lnField = this.$.form0.querySelector('#lastname');
		var posField = this.$.form0.querySelector('#position');
		var pidField = this.$.form0.querySelector('#pid');

		var fname = fnField.querySelector('input').value;
		var lname = lnField.querySelector('input').value;
		var pos = posField.querySelector('input').value;
		var pid = pidField.querySelector('input').value;

		var req = true;
		if (fname == null || fname == '') {
			fnField.isInvalid = true;
			req = false;
		}
		else {
			fnField.isInvalid = false;
		}
		if (lname == null || lname == '') {
			lnField.isInvalid = true;
			req = false;
		}
		else {
			lnField.isInvalid = false;
		}
		if (pid == null || pid == '') {
			pidField.isInvalid = true;
			req = false;
		}
		else {
			pidField.isInvalid = false;
		}

		if (req)
		{
			req = '{"firstname":"' + fname + '","lastname":"' + lname + '","position":"' + pos + '","pid":"' + pid + '"}';
			this.ajaxRequest(req);
		}
	},

	ajaxRequest: function(request) {
		var aj = this.$.ajaxAdd;
		aj.params = request;
		// // Find a way to add the auto attribute without it making requests on startup calling the go method.
		aj.go();
	},

	ajaxResponse: function(e) {
		var resp = JSON.parse(e.detail.response);
		// console.log('Message: ' + resp.message);
		var tip = this.$.tooltip;
		var button = tip.querySelector('paper-button');

		if (resp.responseCode == 1) {
			button.style.backgroundColor = "green";
		}
		else {
			button.style.backgroundColor = "red";
		}

		tip.label = resp.message;
		tip.show = true;
	},

    });
  </script>

</polymer-element>
